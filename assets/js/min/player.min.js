/**
 * JetEngine Audio Stream - Player (minified)
 * @version 1.0.0
 */
const WaveSurfer=window.WaveSurfer||{};class JetAudioPlayer{constructor(e,t={}){if(this.container=document.getElementById(e),!this.container)return void console.error(`Player element #${e} not found`);this.options={postId:null,debug:!1,restUrl:"/wp-json/jetengine-audio-stream/v1/",useWaveform:!0,...t},this.state={isPlaying:!1,duration:0,currentTime:0,loading:!1,audioElement:null,wavesurfer:null,metadataLoaded:!1},this.elements={waveform:this.container.querySelector(".jet-audio-player__waveform"),playPauseBtn:this.container.querySelector(".jet-audio-player__play-pause"),playPauseIcon:this.container.querySelector(".jet-audio-player__play-pause span"),currentTime:this.container.querySelector(".jet-audio-player__current-time"),duration:this.container.querySelector(".jet-audio-player__duration"),downloadBtn:this.container.querySelector(".jet-audio-player__download"),copyUrlBtn:this.container.querySelector(".jet-audio-player__copy-url")},this.init()}init(){this.createAudioElement(),this.options.useWaveform&&this.elements.waveform&&window.WaveSurfer&&this.setupWaveform(),this.loadMetadata(),this.setupEventListeners(),this.log("Audio player initialized")}createAudioElement(){this.state.audioElement=document.createElement("audio"),this.state.audioElement.controls=!1,this.state.audioElement.style.display="none",this.state.audioElement.preload="metadata",this.container.appendChild(this.state.audioElement)}setupWaveform(){this.state.wavesurfer=WaveSurfer.create({container:this.elements.waveform,waveColor:"#c5c5c5",progressColor:"#0073aa",cursorColor:"#0073aa",height:60,normalize:!0,responsive:!0,barWidth:2,barGap:1,interact:!0,backend:"MediaElement",mediaControls:!1}),this.loadPeaksData(),this.state.wavesurfer.on("click",this.handleWaveformSeek.bind(this))}handleWaveformSeek(e){if(this.state.metadataLoaded){const t=e.originalEvent.layerX/this.elements.waveform.clientWidth,a=t*this.state.duration;this.state.audioElement&&(this.state.audioElement.currentTime=a)}}loadMetadata(){if(!this.options.postId)return void this.log("No post ID provided, cannot load metadata",null,!0);const e=`${this.options.restUrl}metadata/${this.options.postId}`;fetch(e).then(e=>{if(!e.ok)throw new Error("Metadata fetch failed");return e.json()}).then(e=>{e.success&&(this.updatePlayerWithMetadata(e),this.log("Metadata loaded successfully",e),e.stream_url&&(this.state.audioElement.src=e.stream_url))}).catch(e=>{this.log("Failed to load metadata",e,!0)})}updatePlayerWithMetadata(e){e.duration&&this.elements.duration&&(this.state.duration=this.parseTimeString(e.duration),this.elements.duration.textContent=e.duration),this.elements.downloadBtn&&e.url&&(this.elements.downloadBtn.href=e.url,this.elements.downloadBtn.download=e.title||"audio"),this.elements.copyUrlBtn&&e.stream_url&&this.elements.copyUrlBtn.setAttribute("data-url",e.stream_url),this.state.metadataLoaded=!0}loadPeaksData(){if(this.state.wavesurfer&&this.options.postId){const e=`${this.options.restUrl}peaks/${this.options.postId}`;fetch(e).then(e=>{if(!e.ok)throw new Error("Peaks data fetch failed");return e.json()}).then(e=>{e.success&&e.peaks&&(this.log("Peaks data loaded",e),this.state.wavesurfer.load(this.state.audioElement,e.peaks))}).catch(e=>{this.log("Failed to load peaks data",e,!0),this.state.wavesurfer.load(this.state.audioElement)})}}setupEventListeners(){this.elements.playPauseBtn&&this.elements.playPauseBtn.addEventListener("click",this.togglePlayPause.bind(this)),this.elements.copyUrlBtn&&this.elements.copyUrlBtn.addEventListener("click",this.handleCopyUrl.bind(this)),this.state.audioElement&&(this.state.audioElement.addEventListener("timeupdate",this.handleTimeUpdate.bind(this)),this.state.audioElement.addEventListener("play",this.handlePlay.bind(this)),this.state.audioElement.addEventListener("pause",this.handlePause.bind(this)),this.state.audioElement.addEventListener("ended",this.handleEnded.bind(this)),this.state.audioElement.addEventListener("error",this.handleError.bind(this)),this.state.audioElement.addEventListener("waiting",()=>{this.state.loading=!0,this.container.classList.add("jet-audio-player--loading")}),this.state.audioElement.addEventListener("canplay",()=>{this.state.loading=!1,this.container.classList.remove("jet-audio-player--loading")})),this.state.wavesurfer&&(this.state.wavesurfer.on("ready",this.handleWaveformReady.bind(this)),this.state.wavesurfer.on("play",this.handleWaveformPlay.bind(this)),this.state.wavesurfer.on("pause",this.handleWaveformPause.bind(this)),this.state.wavesurfer.on("finish",this.handleWaveformFinish.bind(this)))}togglePlayPause(){this.state.audioElement&&(this.state.isPlaying?this.state.audioElement.pause():this.state.audioElement.play().catch(e=>{this.log("Playback failed",e,!0)}))}handlePlay(){this.state.isPlaying=!0,this.container.classList.add("jet-audio-player--playing"),this.elements.playPauseIcon&&(this.elements.playPauseIcon.className="dashicons dashicons-controls-pause"),this.state.wavesurfer&&!this.state.wavesurfer.isPlaying()&&this.state.wavesurfer.play()}handlePause(){this.state.isPlaying=!1,this.container.classList.remove("jet-audio-player--playing"),this.elements.playPauseIcon&&(this.elements.playPauseIcon.className="dashicons dashicons-controls-play"),this.state.wavesurfer&&this.state.wavesurfer.isPlaying()&&this.state.wavesurfer.pause()}handleEnded(){this.state.isPlaying=!1,this.container.classList.remove("jet-audio-player--playing"),this.elements.playPauseIcon&&(this.elements.playPauseIcon.className="dashicons dashicons-controls-play")}handleTimeUpdate(){this.state.currentTime=this.state.audioElement.currentTime,this.elements.currentTime&&(this.elements.currentTime.textContent=this.formatTime(this.state.currentTime))}handleError(e){this.log("Audio playback error",e,!0),this.container.classList.add("jet-audio-player--error")}handleWaveformReady(){this.log("Waveform ready")}handleWaveformPlay(){!this.state.isPlaying&&this.state.audioElement&&this.state.audioElement.play()}handleWaveformPause(){this.state.isPlaying&&this.state.audioElement&&this.state.audioElement.pause()}handleWaveformFinish(){this.state.isPlaying=!1,this.container.classList.remove("jet-audio-player--playing"),this.elements.playPauseIcon&&(this.elements.playPauseIcon.className="dashicons dashicons-controls-play")}handleCopyUrl(e){const t=e.currentTarget.getAttribute("data-url");if(!t)return;const a=document.createElement("textarea");a.value=t,a.style.position="fixed",document.body.appendChild(a),a.select();try{document.execCommand("copy")?alert("Audio URL copied to clipboard!"):this.log("Copy command failed",null,!0)}catch(e){this.log("Error copying to clipboard",e,!0)}document.body.removeChild(a)}formatTime(e){if(isNaN(e)||e<0)return"0:00";const t=Math.floor(e/60),a=Math.floor(e%60);return`${t}:${a.toString().padStart(2,"0")}`}parseTimeString(e){if(!e)return 0;const t=e.split(":");return 2===t.length?60*parseInt(t[0],10)+parseInt(t[1],10):3===t.length?3600*parseInt(t[0],10)+60*parseInt(t[1],10)+parseInt(t[2],10):0}log(e,t=null,a=!1){if(!this.options.debug&&!a)return;const s="[JetEngine Audio Player]";a?console.error(s,e,t):console.log(s,e,t)}}document.addEventListener("DOMContentLoaded",function(){function e(){document.querySelectorAll(".jet-audio-player, .jet-audio-player-container").forEach(function(e){const t=e.getAttribute("data-audio-id");let n=e.getAttribute("data-url");!n&&t&&(n=JetEngineAudioSettings.rest_url+t,e.setAttribute("data-url",n)),n?(a(e),i(e,n)):console.error("JetEngine Audio Stream: No audio URL or ID found for player",e)})}function a(e){0===e.children.length&&(e.innerHTML='\n                <div class="jet-audio-player__waveform"></div>\n                <div class="jet-audio-player__controls">\n                    <button class="jet-audio-player__play-pause">\n                        <span class="dashicons dashicons-controls-play"></span>\n                    </button>\n                    <div class="jet-audio-player__time">\n                        <span class="jet-audio-player__current-time">0:00</span>\n                        <span class="jet-audio-player__duration">0:00</span>\n                    </div>\n                </div>\n            '),e.classList.add("jet-audio-player"),e.classList.add("jet-audio-player--loading")}function i(e,a){const i=e.querySelector(".jet-audio-player__waveform")||e.querySelector(".waveform"),s=e.querySelector(".jet-audio-player__play-pause")||e.querySelector(".play-button"),n=e.querySelector(".jet-audio-player__current-time"),o=e.querySelector(".jet-audio-player__duration"),d=WaveSurfer.create({container:i,waveColor:"#0072ff",progressColor:"#00c6ff",barWidth:2,barRadius:2,height:80,responsive:!0,backend:"MediaElement",normalize:!0,cursorWidth:1,cursorColor:"#ff006e"});d.on("error",function(a){console.error("JetEngine Audio Stream: WaveSurfer error",a),t(e,"Error loading audio: "+a),e.classList.remove("jet-audio-player--loading"),e.classList.add("jet-audio-player--error")}),d.on("ready",function(){const a=d.getDuration();o&&(o.textContent=r(a)),n&&o&&(n.textContent="0:00"),e.classList.remove("jet-audio-player--loading"),l(s,!1)}),d.on("audioprocess",function(){if(n){const e=d.getCurrentTime();n.textContent=r(e)}}),d.on("finish",function(){l(s,!1)}),s&&s.addEventListener("click",function(){d.playPause(),l(s,d.isPlaying())}),d.on("play",function(){l(s,!0)}),d.on("pause",function(){l(s,!1)}),d.load(a)}function t(e,a){console.error("JetEngine Audio Stream: "+a);let i=e.querySelector(".jet-audio-player__error");if(!i){i=document.createElement("div"),i.className="jet-audio-player__error";const a=document.createElement("span");a.className="jet-audio-player__error-icon dashicons dashicons-warning",i.appendChild(a);const t=document.createElement("span");i.appendChild(t),e.appendChild(i)}const t=i.querySelector("span:not(.jet-audio-player__error-icon)");t&&(t.textContent=a)}function l(e,a){if(e)if(e.querySelector(".dashicons")){const i=e.querySelector(".dashicons");i.className=a?"dashicons dashicons-controls-pause":"dashicons dashicons-controls-play"}else e.innerHTML=a?"Pause":"Play"}function r(e){if(isNaN(e)||!isFinite(e))return"0:00";const a=Math.floor(e/60),i=Math.floor(e%60);return`${a}:${i.toString().padStart(2,"0")}`}e(),document.addEventListener("jet-engine/listing/content-updated",function(){e()})}); 