(function(){let audioControlsTemplate=`<div class="jet-audio-player-controls"><button type="button" class="jet-audio-player__play-pause" title="Play/Pause"><i class="fas fa-play"></i></button><div class="jet-audio-player__time">0:00 / 0:00</div><div class="jet-audio-player__volume"><input type="range" min="0" max="1" step="0.01" value="1" class="jet-audio-player__volume-control"></div><button type="button" class="jet-audio-player__download" title="Download"><i class="fas fa-download"></i></button><button type="button" class="jet-audio-player__copy-url" title="Copy URL"><i class="fas fa-link"></i></button></div>`;class JetEngineListingAudio{constructor(){this.players={};this.observerActive=false;this.initEventListeners()}initEventListeners(){document.addEventListener("click",e=>{const playBtn=e.target.closest(".jet-audio-player__play-pause");if(playBtn){this.handlePlayClick(playBtn)}const downloadBtn=e.target.closest(".jet-audio-player__download");if(downloadBtn){this.handleDownloadClick(downloadBtn)}const copyBtn=e.target.closest(".jet-audio-player__copy-url");if(copyBtn){this.handleCopyClick(copyBtn)}});document.addEventListener("input",e=>{const volumeControl=e.target.closest(".jet-audio-player__volume-control");if(volumeControl){this.handleVolumeChange(volumeControl)}});document.addEventListener("jet-engine/listing-grid/after-load-more",()=>{this.initListingAudioPlayers()});document.addEventListener("jet-engine/listing-grid/after-load-page",()=>{this.initListingAudioPlayers()});document.addEventListener("jet-engine/listing-grid/after-render",()=>{setTimeout(()=>this.initListingAudioPlayers(),10)});document.addEventListener("jet-filter-content-rendered",()=>{setTimeout(()=>this.initListingAudioPlayers(),10)});document.addEventListener("elementor/popup/show",()=>{setTimeout(()=>this.initListingAudioPlayers(),10)});window.addEventListener("load",()=>{this.initObserver();this.initListingAudioPlayers()})}initListingAudioPlayers(){const audioContainers=document.querySelectorAll(".jet-audio-player-container:not(.jet-audio-player-initialized)");if(!audioContainers.length){return}audioContainers.forEach(container=>{try{container.classList.add("jet-audio-player-initialized");const audioId=container.dataset.audioId;if(!audioId){return}const audioUrl=`${JetEngineAudioSettings.rest_url}${audioId}`;const wavesurferContainer=document.createElement("div");wavesurferContainer.className="jet-audio-player__waveform";container.appendChild(wavesurferContainer);container.innerHTML+=audioControlsTemplate;const wavesurfer=WaveSurfer.create({container:wavesurferContainer,waveColor:"var(--jet-audio-wave-color, #ddd)",progressColor:"var(--jet-audio-progress-color, #1e7ed6)",cursorColor:"var(--jet-audio-cursor-color, transparent)",barWidth:2,barRadius:3,cursorWidth:0,height:50,barGap:2,responsive:true,normalize:true,fillParent:true,url:audioUrl});const playPauseBtn=container.querySelector(".jet-audio-player__play-pause");const timeDisplay=container.querySelector(".jet-audio-player__time");wavesurfer.on("ready",()=>{playPauseBtn.disabled=false;timeDisplay.textContent=`0:00 / ${this.formatTime(wavesurfer.getDuration())}`});wavesurfer.on("audioprocess",()=>{timeDisplay.textContent=`${this.formatTime(wavesurfer.getCurrentTime())} / ${this.formatTime(wavesurfer.getDuration())}`});wavesurfer.on("play",()=>{playPauseBtn.innerHTML='<i class="fas fa-pause"></i>';this.pauseOtherPlayers(audioId)});wavesurfer.on("pause",()=>{playPauseBtn.innerHTML='<i class="fas fa-play"></i>'});wavesurfer.on("finish",()=>{playPauseBtn.innerHTML='<i class="fas fa-play"></i>'});this.players[audioId]=wavesurfer}catch(e){console.error("Error initializing audio player:",e)}})}handlePlayClick(button){const container=button.closest(".jet-audio-player-container");const audioId=container.dataset.audioId;const player=this.players[audioId];if(player){player.isPlaying()?player.pause():player.play()}}handleVolumeChange(control){const container=control.closest(".jet-audio-player-container");const audioId=container.dataset.audioId;const player=this.players[audioId];if(player){player.setVolume(control.value)}}handleDownloadClick(button){const container=button.closest(".jet-audio-player-container");const audioId=container.dataset.audioId;if(audioId){const downloadUrl=`${JetEngineAudioSettings.rest_url}${audioId}?download=1`;window.open(downloadUrl,"_blank")}}handleCopyClick(button){const container=button.closest(".jet-audio-player-container");const audioId=container.dataset.audioId;if(audioId&&navigator.clipboard){const audioUrl=`${JetEngineAudioSettings.rest_url}${audioId}`;navigator.clipboard.writeText(audioUrl).then(()=>{this.showCopyNotification(button,"URL copied!")}).catch(err=>{console.error("Could not copy text: ",err)})}}showCopyNotification(button,message){const notification=document.createElement("div");notification.className="jet-audio-copy-notification";notification.textContent=message;button.appendChild(notification);setTimeout(()=>{notification.remove()},2000)}pauseOtherPlayers(currentId){Object.keys(this.players).forEach(id=>{if(id!==currentId&&this.players[id].isPlaying()){this.players[id].pause()}})}formatTime(time){if(isNaN(time)||!isFinite(time)){return"0:00"}const minutes=Math.floor(time/60);const seconds=Math.floor(time%60);return`${minutes}:${seconds.toString().padStart(2,"0")}`}initObserver(){if(this.observerActive||!window.IntersectionObserver){return}this.observerActive=true;const options={root:null,rootMargin:"0px",threshold:0.1};const observer=new IntersectionObserver(entries=>{entries.forEach(entry=>{if(entry.isIntersecting){const container=entry.target;if(!container.classList.contains("jet-audio-player-initialized")){container.classList.add("jet-audio-player-initialized");const audioId=container.dataset.audioId;if(!audioId){return}const audioUrl=`${JetEngineAudioSettings.rest_url}${audioId}`;const wavesurferContainer=document.createElement("div");wavesurferContainer.className="jet-audio-player__waveform";container.appendChild(wavesurferContainer);container.innerHTML+=audioControlsTemplate;const wavesurfer=WaveSurfer.create({container:wavesurferContainer,waveColor:"var(--jet-audio-wave-color, #ddd)",progressColor:"var(--jet-audio-progress-color, #1e7ed6)",cursorColor:"var(--jet-audio-cursor-color, transparent)",barWidth:2,barRadius:3,cursorWidth:0,height:50,barGap:2,responsive:true,normalize:true,fillParent:true,url:audioUrl});const playPauseBtn=container.querySelector(".jet-audio-player__play-pause");const timeDisplay=container.querySelector(".jet-audio-player__time");wavesurfer.on("ready",()=>{playPauseBtn.disabled=false;timeDisplay.textContent=`0:00 / ${this.formatTime(wavesurfer.getDuration())}`});wavesurfer.on("audioprocess",()=>{timeDisplay.textContent=`${this.formatTime(wavesurfer.getCurrentTime())} / ${this.formatTime(wavesurfer.getDuration())}`});wavesurfer.on("play",()=>{playPauseBtn.innerHTML='<i class="fas fa-pause"></i>';this.pauseOtherPlayers(audioId)});wavesurfer.on("pause",()=>{playPauseBtn.innerHTML='<i class="fas fa-play"></i>'});wavesurfer.on("finish",()=>{playPauseBtn.innerHTML='<i class="fas fa-play"></i>'});this.players[audioId]=wavesurfer;observer.unobserve(container)}}})}},options);document.querySelectorAll(".jet-audio-player-container:not(.jet-audio-player-initialized)").forEach(container=>{observer.observe(container)})}}window.JetEngineListingAudio=new JetEngineListingAudio()})(); 